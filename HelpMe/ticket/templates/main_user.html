{% extends 'base_main.html' %}

{% block title %}HelpME - Main Page{% endblock %}

{% block content %}
<div class="welcome">
  Hello {{ request.user.first_name|default:request.user.username }}, what can we help you with today?
</div>

<button class="btn" onclick="openModal()">Create New Ticket</button>

<div class="conversation-list">
  {% for ticket in tickets %}
  <div class="conversation" onclick="window.location.href='{% url 'chat' ticket.id %}'" style="cursor: pointer;">
    <div class="conversation-title">{{ ticket.title }}</div>
    <div class="conversation-info">
      <span class="conversation-priority {{ ticket.priority|lower }}">{{ ticket.priority }}</span>
      <span class="conversation-status {{ ticket.status|lower }}">{{ ticket.status }}</span>
      <span class="conversation-date">{{ ticket.created_at|date:"Y-m-d" }}</span>
    </div>
  </div>
  {% empty %}
  <div class="no-tickets">
    No tickets yet. Create your first ticket by clicking the button above.
  </div>
  {% endfor %}
</div>
{% endblock %}

{% block modals %}
<!-- Modal -->
<div class="modal" id="conversationModal">
  <div class="modal-content">
    <h2>Create New Ticket</h2>
    <form id="ticketForm" method="post" action="{% url 'create_ticket' %}">
      {% csrf_token %}
      <div class="form-group">
        <label for="id_title">Subject</label>
        {{ form.title }}
        {% if form.title.errors %}
      <div class="error">{{ form.title.errors.0 }}</div>
      {% endif %}
      </div>

      <div class="form-group">
        <label for="id_priority">Priority</label>
        {{ form.priority }}
        {% if form.priority.errors %}
      <div class="error">{{ form.priority.errors.0 }}</div>
      {% endif %}
      </div>

      <div class="form-group">
        <label for="id_description">Description</label>
        {{ form.description }}
        {% if form.description.errors %}
      <div class="error">{{ form.description.errors.0 }}</div>
      {% endif %}
      </div>

      <div class="modal-actions">
        <button type="button" class="cancel-btn" onclick="closeModal()">
          Cancel
        </button>
        <button type="submit" class="save-btn">Create</button>
      </div>
    </form>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
// Show SweetAlert for success messages
{% if messages %}
    {% for message in messages %}
        {% if message.tags == 'success' %}
            closeModal();
            Swal.fire({
                icon: 'success',
                title: 'Success!',
                text: '{{ message }}',
                confirmButtonColor: '#3085d6'
            });
        {% endif %}
    {% endfor %}
{% endif %}
</script>
{% endblock %}
