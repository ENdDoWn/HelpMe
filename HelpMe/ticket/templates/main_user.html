{% extends 'base_main.html' %}

{% block title %}HelpME - Main Page{% endblock %}

{% block content %}
<div class="welcome">
  Hello {{ request.user.first_name|default:request.user.username }}, what can we help you today?
</div>

<button class="btn" onclick="openModal()">Create New Ticket</button>

<div class="conversation-list">
  {% for ticket in tickets %}
    {% if ticket.status == 'closed' %}
    <div class="conversation" style="background-color: #f8f9fa; opacity: 0.6;" onclick="window.location.href='{% url 'chat' ticket.id %}'">
      <div class="conversation-title">{{ ticket.title }}</div>
      <div class="conversation-info">
        <span class="conversation-priority {{ ticket.priority|lower }}" style="padding: 3px 8px; border-radius: 4px; {% if ticket.priority == 'LOW' %}background: #28a745; color: white;{% elif ticket.priority == 'MEDIUM' %}background: #ffc107; color: black;{% else %}background: #dc3545; color: white;{% endif %}">{{ ticket.priority }}</span>
        <span class="conversation-status {{ ticket.status|lower }}" style="padding: 3px 8px; border-radius: 4px; background: #4d4d4dff; color: white;">{{ ticket.status }}</span>
        <span class="conversation-date">{{ ticket.created_at|date:"Y-m-d" }}</span>
      </div>
    </div>
    {% else %}
    <div class="conversation" onclick="window.location.href='{% url 'chat' ticket.id %}'" style="cursor: pointer;">
      <div class="conversation-title">{{ ticket.title }}</div>
      <div class="conversation-info">
        <span class="conversation-priority {{ ticket.priority|lower }}" style="padding: 3px 8px; border-radius: 4px; {% if ticket.priority == 'LOW' %}background: #28a745; color: white;{% elif ticket.priority == 'MEDIUM' %}background: #ffc107; color: black;{% else %}background: #dc3545; color: white;{% endif %}">{{ ticket.priority }}</span>
        <span class="conversation-status {{ ticket.status|lower }}" style="padding: 3px 8px; border-radius: 4px; background: #4174ffff; color: white;">{{ ticket.status }}</span>
        <span class="conversation-date">{{ ticket.created_at|date:"Y-m-d" }}</span>
      </div>
    </div>
    {% endif %}
  {% empty %}
  <div class="no-tickets">
    No tickets yet. Create your first ticket by clicking the button above.
  </div>
  {% endfor %}
</div>
{% endblock %}

{% block modals %}
<!-- Modal -->
<div class="modal" id="conversationModal">
  <div class="modal-content">
    <h2>Create New Ticket</h2>
    <form id="ticketForm" method="post" action="{% url 'create_ticket' %}">
      {% csrf_token %}
      <div class="form-group">
        <label for="id_title">Subject</label>
        {{ form.title }}
        {% if form.title.errors %}
      <div class="error">{{ form.title.errors.0 }}</div>
      {% endif %}
      </div>

      <div class="form-group">
        <label for="id_priority">Priority</label>
        {{ form.priority }}
        {% if form.priority.errors %}
      <div class="error">{{ form.priority.errors.0 }}</div>
      {% endif %}
      </div>

      <div class="form-group">
        <label for="id_description">Description</label>
        {{ form.description }}
        {% if form.description.errors %}
      <div class="error">{{ form.description.errors.0 }}</div>
      {% endif %}
      </div>

      <div class="modal-actions">
        <button type="button" class="cancel-btn" onclick="closeModal()">
          Cancel
        </button>
        <button type="submit" class="save-btn">Create</button>
      </div>
    </form>
  </div>
</div>
{% endblock %}

{% block extra_css %}
<style>
.conversation:not([style*="opacity"]):hover {
  background-color: #f5f5f5;
  transform: translateY(-2px);
  transition: all 0.2s ease-in-out;
  box-shadow: 0 2px 5px rgba(0,0,0,0.1);
}
</style>
{% endblock %}
