{% extends 'base_main.html' %}

{% load static %}

{% block title %}HelpME - Chat{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/chat.css' %}">
{% endblock %}

{% block extra_js %}
<script src="{% static "js/chat.js" %}%}"></script>
{% endblock %}

{% block content %}
<div class="chat-container">
  <div class="chat-body">
    <div class="chat-header">
      <a href="{% if request.user.groups.all.0.name == 'Agents' %}{% url 'main_agent' %}{% else %}{% url 'main_user' %}{% endif %}" class="back-btn">← Back</a>
      <h2>{{ ticket.title }}</h2>
    </div>

    <div class="messages">
      {% for message in messages %}
        <div class="message {% if message.user == request.user %}self{% else %}other{% endif %}">
          <div class="sender">{{ message.user.get_full_name|default:message.user.username }}</div>
          <div class="text">
            {{ message.msg }}
            <span class="time">{{ message.created_at|date:"h:i A d/M/Y" }}</span>
          </div>
        </div>
      {% empty %}
      {% endfor %}
    </div>

    <form class="chat-input" id="chatForm">
      {% csrf_token %}
      <input type="text" id="messageInput" placeholder="Type your message..." required>
      <button type="submit">➤</button>
    </form>
  </div>

  <div class="ticket-info">
    <h3>Ticket Information</h3>
    <div>
      <label>Created on</label>
      <div class="value">{{ ticket.created_at|date:"d M Y, h:i A" }}</div>
    </div>
    <div>
      <label>Priority</label>
      <div class="priority {{ ticket.priority|lower }}">{{ ticket.get_priority_display }}</div>
    </div>
    <div>
      <label>Status</label>
      <div class="value">{{ ticket.get_status_display }}</div>
    </div>
    <div>
      <label>Owner</label>
      <div class="value">{{ ticket.creator.get_full_name|default:ticket.creator.username }}</div>
    </div>
    <div>
      <label>Description</label>
      <div class="value" style="white-space: pre-wrap;">{{ ticket.description }}</div>
    </div>
  </div>
</div>
{% endblock %}
